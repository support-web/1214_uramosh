# 占い師特化型予約・決済プラットフォーム「ウラナビ」仕様書

## 1. サービス概要

### 1.1 サービス名
**ウラナビ（UraNav）** - 占い師と相談者をつなぐオンラインプラットフォーム

### 1.2 コンセプト
「あなたの運命を、もっと身近に」

占い師が簡単に自分のサービスページを作成・運営でき、相談者が安心して占いサービスを予約・利用できるプラットフォーム。MOSHの使いやすさを継承しつつ、占い業界特有のニーズに対応した専門機能を提供する。

### 1.3 ターゲットユーザー

#### サービス提供者（占い師）
- 個人で活動する占い師
- 占いサロン・事務所
- 副業として占いを始めたい人
- オンライン鑑定を始めたい対面占い師

#### サービス利用者（相談者）
- 占いに興味がある一般ユーザー
- 定期的に占いを利用するリピーター
- 特定の悩み（恋愛・仕事・健康など）を抱える人

---

## 2. システム構成

### 2.1 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | Next.js 14 (App Router), TypeScript, Tailwind CSS |
| バックエンド | Node.js, Express / NestJS |
| データベース | PostgreSQL, Redis (キャッシュ・セッション) |
| ファイルストレージ | AWS S3 / Cloudflare R2 |
| 認証 | NextAuth.js / Firebase Auth |
| 決済 | Stripe Connect |
| ビデオ通話 | Zoom API / Twilio / Daily.co |
| チャット | WebSocket (Socket.io) |
| ホスティング | Vercel / AWS |
| 監視 | Sentry, Datadog |

### 2.2 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    クライアント層                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  Webアプリ    │  │  iOS アプリ   │  │ Androidアプリ │       │
│  │  (Next.js)   │  │  (React Native)│ │ (React Native)│       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     API Gateway                              │
│                    (認証・レート制限)                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   マイクロサービス層                           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ユーザー  │ │ 予約    │ │ 決済    │ │ 通知    │           │
│  │サービス  │ │サービス  │ │サービス  │ │サービス  │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │チャット  │ │ビデオ   │ │レビュー  │ │コンテンツ│           │
│  │サービス  │ │サービス  │ │サービス  │ │サービス  │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    データ層                                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                  │
│  │PostgreSQL │  │  Redis   │  │   S3     │                  │
│  └──────────┘  └──────────┘  └──────────┘                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 機能要件

### 3.1 占い師向け機能

#### 3.1.1 アカウント・プロフィール管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 会員登録 | メール/SNS（LINE, Google, Apple）認証 | 必須 |
| 本人確認 | 身分証明書アップロード・審査 | 必須 |
| プロフィール設定 | 占い師名、アイコン、自己紹介、経歴 | 必須 |
| 占術設定 | 対応占術の選択（複数選択可） | 必須 |
| 得意ジャンル設定 | 恋愛、仕事、金運、健康など | 必須 |
| ギャラリー | 活動写真、鑑定風景などの掲載 | 推奨 |
| 資格・実績表示 | 保有資格、メディア出演歴など | 推奨 |

##### 対応占術マスタ
```
- タロット占い
- 西洋占星術
- 四柱推命
- 九星気学
- 手相占い
- 数秘術
- 霊視・霊感
- オラクルカード
- ルーン占い
- 風水
- 姓名判断
- 夢占い
- その他
```

##### 相談ジャンルマスタ
```
- 恋愛・結婚
- 復縁・復活愛
- 不倫・浮気
- 仕事・キャリア
- 転職・就職
- 人間関係
- 家庭問題
- 健康・病気
- 金運・財運
- 開運・運勢
- 前世・過去世
- ペット
- その他
```

#### 3.1.2 サービスページ作成

| 機能 | 説明 | 優先度 |
|------|------|--------|
| サービス基本情報 | タイトル、説明文、サムネイル画像 | 必須 |
| 料金設定 | 時間単位/固定料金/初回割引 | 必須 |
| 鑑定形式設定 | 対面/電話/ビデオ通話/チャット/メール | 必須 |
| 所要時間設定 | 10分/20分/30分/60分/カスタム | 必須 |
| 予約可能枠設定 | カレンダー連携、曜日・時間帯設定 | 必須 |
| オプション追加 | 延長料金、追加質問料金など | 推奨 |
| SEO設定 | メタタグ、OGP設定 | 推奨 |

##### 鑑定形式詳細

```typescript
enum ConsultationType {
  VIDEO_CALL = 'video_call',      // ビデオ通話鑑定
  VOICE_CALL = 'voice_call',      // 電話・音声通話鑑定
  CHAT = 'chat',                   // リアルタイムチャット鑑定
  EMAIL = 'email',                 // メール鑑定（非同期）
  IN_PERSON = 'in_person',         // 対面鑑定
}
```

#### 3.1.3 予約・スケジュール管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| カレンダー表示 | 日/週/月表示の予約カレンダー | 必須 |
| 予約受付設定 | 受付開始日時・締切日時の設定 | 必須 |
| Googleカレンダー連携 | 双方向同期 | 必須 |
| 休業日設定 | 臨時休業、定休日の設定 | 必須 |
| 予約承認 | 自動承認/手動承認の選択 | 必須 |
| 予約変更・キャンセル | ポリシー設定、自動処理 | 必須 |
| リマインド通知 | 予約前日・当日の自動通知 | 必須 |
| ダブルブッキング防止 | 自動枠管理 | 必須 |

#### 3.1.4 決済・売上管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 事前決済 | クレジットカード決済（Stripe） | 必須 |
| 売上ダッシュボード | 日次/週次/月次の売上確認 | 必須 |
| 振込申請 | 売上金の銀行振込申請 | 必須 |
| 請求書発行 | PDF形式での請求書自動生成 | 推奨 |
| 売上レポート | CSV/Excelエクスポート | 推奨 |

#### 3.1.5 顧客管理（CRM）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 顧客リスト | 予約履歴のある顧客一覧 | 必須 |
| 顧客詳細 | 生年月日、相談履歴、メモ | 必須 |
| 鑑定メモ | 各セッション後のメモ記録 | 必須 |
| タグ付け | 顧客分類用のカスタムタグ | 推奨 |
| 一斉メッセージ | 顧客への一括お知らせ送信 | 推奨 |
| リピート率分析 | 顧客の再訪傾向分析 | 推奨 |

#### 3.1.6 コンテンツ販売

| 機能 | 説明 | 優先度 |
|------|------|--------|
| デジタルコンテンツ販売 | PDF鑑定書、動画講座など | 推奨 |
| 月額サブスク | 会員限定コンテンツの提供 | 推奨 |
| 回数券 | 複数回セットの割引販売 | 推奨 |
| オンラインサロン | ファンコミュニティ運営 | 将来 |

#### 3.1.7 マーケティング機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| クーポン発行 | 割引クーポンの作成・配布 | 必須 |
| SNS連携 | Instagram, Twitter, LINE公式 | 必須 |
| 紹介プログラム | 紹介コードによる割引・報酬 | 推奨 |
| ブログ機能 | 占い情報の発信 | 推奨 |
| 今日の運勢配信 | 自動運勢メッセージ配信 | 将来 |

---

### 3.2 相談者向け機能

#### 3.2.1 アカウント管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 会員登録 | メール/SNS認証 | 必須 |
| プロフィール設定 | ニックネーム、生年月日、性別 | 必須 |
| 生年月日・出生時刻 | ホロスコープ等に使用（任意） | 推奨 |
| お気に入り登録 | 気になる占い師の保存 | 必須 |

#### 3.2.2 占い師検索・発見

| 機能 | 説明 | 優先度 |
|------|------|--------|
| キーワード検索 | 占い師名、占術、ジャンルで検索 | 必須 |
| フィルター検索 | 料金帯、評価、鑑定形式、対応時間 | 必須 |
| おすすめ表示 | パーソナライズされたレコメンド | 推奨 |
| ランキング表示 | 人気・評価の高い占い師 | 必須 |
| 新着占い師 | 最近登録された占い師 | 推奨 |
| 今すぐ鑑定可能 | リアルタイム空き状況表示 | 必須 |

##### 検索・ソート条件
```typescript
interface SearchFilters {
  keywords?: string;
  divination_types?: string[];      // 占術
  consultation_genres?: string[];   // 相談ジャンル
  consultation_types?: ConsultationType[];  // 鑑定形式
  price_min?: number;
  price_max?: number;
  rating_min?: number;              // 最低評価
  available_now?: boolean;          // 今すぐ可能
  available_date?: Date;            // 指定日に空きあり
  sort_by?: 'rating' | 'reviews' | 'price_low' | 'price_high' | 'new';
}
```

#### 3.2.3 予約・決済

| 機能 | 説明 | 優先度 |
|------|------|--------|
| カレンダー予約 | 空き枠の確認・予約 | 必須 |
| 即時予約 | 今すぐ鑑定開始（待機中占い師） | 必須 |
| 事前質問入力 | 相談内容の事前共有 | 必須 |
| クレジットカード決済 | Visa, Master, JCB, AMEX | 必須 |
| コンビニ決済 | PayPay, LINE Pay等 | 推奨 |
| ポイント利用 | 貯まったポイントでの支払い | 推奨 |
| 予約変更・キャンセル | マイページから操作 | 必須 |

#### 3.2.4 鑑定セッション

| 機能 | 説明 | 優先度 |
|------|------|--------|
| ビデオ通話 | Zoom/独自ビデオシステム | 必須 |
| 音声通話 | WebRTC音声通話 | 必須 |
| チャット鑑定 | リアルタイムテキストチャット | 必須 |
| 画面共有 | 占い師からの資料共有 | 推奨 |
| セッション延長 | 終了前の延長リクエスト | 必須 |
| 残り時間表示 | セッション残時間のカウントダウン | 必須 |

#### 3.2.5 履歴・レビュー

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 鑑定履歴 | 過去の鑑定一覧・詳細 | 必須 |
| レビュー投稿 | 星評価（5段階）+ テキスト | 必須 |
| 鑑定結果保存 | メール鑑定結果の閲覧 | 必須 |
| 再予約 | 履歴からの簡単再予約 | 必須 |

#### 3.2.6 コミュニケーション

| 機能 | 説明 | 優先度 |
|------|------|--------|
| ダイレクトメッセージ | 占い師への事前問い合わせ | 推奨 |
| お知らせ受信 | お気に入り占い師からの通知 | 必須 |
| フォロー機能 | 占い師のフォロー | 推奨 |

---

### 3.3 管理者向け機能

#### 3.3.1 ユーザー管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 占い師審査 | 登録申請の承認・却下 | 必須 |
| 本人確認審査 | 身分証明書の確認 | 必須 |
| アカウント停止 | 規約違反ユーザーの対応 | 必須 |
| ユーザー検索 | 条件指定でのユーザー検索 | 必須 |

#### 3.3.2 コンテンツ管理

| 機能 | 説明 | 優先度 |
|------|------|--------|
| レビュー監視 | 不適切レビューの確認・削除 | 必須 |
| 通報管理 | ユーザー通報の対応 | 必須 |
| お知らせ配信 | 全ユーザーへの通知 | 必須 |

#### 3.3.3 売上・分析

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 全体売上管理 | プラットフォーム全体の売上 | 必須 |
| 手数料管理 | 占い師別の手数料計算 | 必須 |
| KPIダッシュボード | MAU, 売上, 成約率等 | 必須 |
| レポート出力 | 各種分析レポートの出力 | 推奨 |

#### 3.3.4 システム設定

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 手数料率設定 | プラットフォーム手数料の設定 | 必須 |
| マスタ管理 | 占術・ジャンル等のマスタ編集 | 必須 |
| メールテンプレート | 自動送信メールの編集 | 推奨 |

---

## 4. データベース設計

### 4.1 ER図（主要エンティティ）

```
┌─────────────────┐       ┌─────────────────┐
│     Users       │       │   Diviners      │
├─────────────────┤       ├─────────────────┤
│ id              │───────│ id              │
│ email           │       │ user_id (FK)    │
│ password_hash   │       │ display_name    │
│ role            │       │ bio             │
│ created_at      │       │ profile_image   │
│ updated_at      │       │ status          │
└─────────────────┘       │ verified_at     │
                          │ rating_avg      │
                          │ review_count    │
                          └─────────────────┘
                                   │
                                   │ 1:N
                                   ▼
┌─────────────────┐       ┌─────────────────┐
│    Clients      │       │    Services     │
├─────────────────┤       ├─────────────────┤
│ id              │       │ id              │
│ user_id (FK)    │       │ diviner_id (FK) │
│ nickname        │       │ title           │
│ birth_date      │       │ description     │
│ birth_time      │       │ type            │
│ gender          │       │ duration_min    │
└─────────────────┘       │ price           │
         │                │ is_active       │
         │                └─────────────────┘
         │                         │
         │                         │ 1:N
         │                         ▼
         │                ┌─────────────────┐
         │                │  Availability   │
         │                ├─────────────────┤
         │                │ id              │
         │                │ service_id (FK) │
         │                │ day_of_week     │
         │                │ start_time      │
         │                │ end_time        │
         │                │ is_available    │
         │                └─────────────────┘
         │
         │ N:1                      1:N
         ▼                           ▼
┌─────────────────┐       ┌─────────────────┐
│   Bookings      │       │    Reviews      │
├─────────────────┤       ├─────────────────┤
│ id              │◄──────│ id              │
│ client_id (FK)  │       │ booking_id (FK) │
│ service_id (FK) │       │ rating          │
│ scheduled_at    │       │ comment         │
│ duration_min    │       │ is_visible      │
│ status          │       │ created_at      │
│ total_amount    │       └─────────────────┘
│ session_url     │
│ pre_question    │
│ memo            │
└─────────────────┘
         │
         │ 1:1
         ▼
┌─────────────────┐
│   Payments      │
├─────────────────┤
│ id              │
│ booking_id (FK) │
│ amount          │
│ fee_amount      │
│ stripe_id       │
│ status          │
│ paid_at         │
└─────────────────┘
```

### 4.2 主要テーブル定義

#### users テーブル
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    role VARCHAR(20) NOT NULL DEFAULT 'client', -- 'client', 'diviner', 'admin'
    email_verified_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);
```

#### diviners テーブル（占い師）
```sql
CREATE TABLE diviners (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    display_name VARCHAR(100) NOT NULL,
    bio TEXT,
    profile_image_url VARCHAR(500),
    cover_image_url VARCHAR(500),
    years_of_experience INTEGER,
    status VARCHAR(20) DEFAULT 'pending', -- 'pending', 'approved', 'suspended'
    is_online BOOLEAN DEFAULT FALSE,
    verified_at TIMESTAMP,
    rating_avg DECIMAL(3,2) DEFAULT 0,
    review_count INTEGER DEFAULT 0,
    booking_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### diviner_divination_types テーブル（占い師×占術）
```sql
CREATE TABLE diviner_divination_types (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    diviner_id UUID REFERENCES diviners(id),
    divination_type_id UUID REFERENCES divination_types(id),
    is_primary BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### services テーブル（鑑定サービス）
```sql
CREATE TABLE services (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    diviner_id UUID REFERENCES diviners(id),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    thumbnail_url VARCHAR(500),
    consultation_type VARCHAR(30) NOT NULL, -- 'video_call', 'voice_call', 'chat', 'email', 'in_person'
    duration_minutes INTEGER NOT NULL,
    price INTEGER NOT NULL, -- 円単位
    first_time_price INTEGER, -- 初回割引価格
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### bookings テーブル（予約）
```sql
CREATE TABLE bookings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    client_id UUID REFERENCES clients(id),
    service_id UUID REFERENCES services(id),
    scheduled_at TIMESTAMP NOT NULL,
    duration_minutes INTEGER NOT NULL,
    extended_minutes INTEGER DEFAULT 0,
    status VARCHAR(30) DEFAULT 'pending', 
    -- 'pending', 'confirmed', 'in_progress', 'completed', 'cancelled', 'no_show'
    total_amount INTEGER NOT NULL,
    session_url VARCHAR(500), -- ビデオ通話URL等
    pre_question TEXT, -- 事前質問
    diviner_memo TEXT, -- 占い師メモ（非公開）
    cancelled_at TIMESTAMP,
    cancel_reason TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### reviews テーブル
```sql
CREATE TABLE reviews (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    booking_id UUID REFERENCES bookings(id),
    client_id UUID REFERENCES clients(id),
    diviner_id UUID REFERENCES diviners(id),
    rating INTEGER NOT NULL CHECK (rating BETWEEN 1 AND 5),
    comment TEXT,
    is_visible BOOLEAN DEFAULT TRUE,
    reply_text TEXT, -- 占い師からの返信
    replied_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 5. API設計

### 5.1 認証API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/auth/register` | POST | ユーザー登録 |
| `/api/auth/login` | POST | ログイン |
| `/api/auth/logout` | POST | ログアウト |
| `/api/auth/refresh` | POST | トークン更新 |
| `/api/auth/password/reset` | POST | パスワードリセット |
| `/api/auth/verify-email` | POST | メール認証 |

### 5.2 占い師API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/diviners` | GET | 占い師一覧取得 |
| `/api/diviners/:id` | GET | 占い師詳細取得 |
| `/api/diviners/:id/services` | GET | サービス一覧取得 |
| `/api/diviners/:id/reviews` | GET | レビュー一覧取得 |
| `/api/diviners/:id/availability` | GET | 空き状況取得 |
| `/api/diviners/me` | GET | 自分の情報取得 |
| `/api/diviners/me` | PUT | プロフィール更新 |
| `/api/diviners/me/services` | POST | サービス作成 |
| `/api/diviners/me/services/:id` | PUT | サービス更新 |
| `/api/diviners/me/online-status` | PUT | オンライン状態更新 |

### 5.3 予約API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/bookings` | POST | 予約作成 |
| `/api/bookings/:id` | GET | 予約詳細取得 |
| `/api/bookings/:id/cancel` | POST | 予約キャンセル |
| `/api/bookings/:id/extend` | POST | セッション延長 |
| `/api/bookings/me` | GET | 自分の予約一覧 |

### 5.4 決済API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/payments/intent` | POST | 決済インテント作成 |
| `/api/payments/:id/confirm` | POST | 決済確定 |
| `/api/payments/webhook` | POST | Stripeウェブフック |

### 5.5 レビューAPI

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| `/api/reviews` | POST | レビュー投稿 |
| `/api/reviews/:id` | PUT | レビュー更新 |
| `/api/reviews/:id/reply` | POST | 占い師返信 |

---

## 6. 画面設計

### 6.1 画面一覧

#### 共通画面
- トップページ
- ログイン
- 新規登録
- パスワードリセット
- 利用規約
- プライバシーポリシー
- お問い合わせ
- FAQ

#### 相談者向け画面
- 占い師検索・一覧
- 占い師詳細プロフィール
- サービス詳細
- 予約カレンダー
- 予約確認・決済
- 予約完了
- マイページ（ダッシュボード）
- 予約履歴
- お気に入り一覧
- レビュー投稿
- 設定

#### 占い師向け画面
- 占い師登録フロー
- ダッシュボード
- 予約管理
- スケジュール設定
- サービス管理
- 顧客管理
- 売上管理
- プロフィール編集
- レビュー管理
- 設定

#### 鑑定画面
- 鑑定ルーム（ビデオ通話）
- チャット鑑定画面
- 待機画面

#### 管理者画面
- 管理ダッシュボード
- 占い師審査
- ユーザー管理
- 通報管理
- 売上レポート
- システム設定

### 6.2 主要画面ワイヤーフレーム概要

#### トップページ
```
┌────────────────────────────────────────────┐
│  ロゴ    検索バー        ログイン / 登録    │
├────────────────────────────────────────────┤
│                                            │
│        ヒーローセクション                   │
│   「あなたにぴったりの占い師が見つかる」      │
│       [今すぐ占い師を探す]                  │
│                                            │
├────────────────────────────────────────────┤
│  カテゴリー選択                             │
│  [恋愛] [仕事] [金運] [健康] [人間関係]     │
├────────────────────────────────────────────┤
│  人気の占い師                 [もっと見る]   │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐            │
│  │占1  │ │占2  │ │占3  │ │占4  │            │
│  │★4.8│ │★4.9│ │★4.7│ │★4.8│            │
│  └────┘ └────┘ └────┘ └────┘            │
├────────────────────────────────────────────┤
│  今すぐ鑑定可能                             │
│  ● オンライン中の占い師一覧                  │
├────────────────────────────────────────────┤
│  新着占い師                                 │
├────────────────────────────────────────────┤
│  フッター                                   │
└────────────────────────────────────────────┘
```

#### 占い師詳細ページ
```
┌────────────────────────────────────────────┐
│  ← 戻る              占い師名      ♡ お気に入り │
├────────────────────────────────────────────┤
│  ┌──────────┐                              │
│  │          │   占い師名                   │
│  │  写真    │   ★4.8 (123件) │ 鑑定歴5年   │
│  │          │   タロット・西洋占星術        │
│  └──────────┘   ● オンライン中              │
├────────────────────────────────────────────┤
│  [プロフィール] [サービス] [レビュー]        │
├────────────────────────────────────────────┤
│  自己紹介                                   │
│  ────────────────────────                  │
│  得意な相談：恋愛、復縁、仕事               │
│  使用占術：タロット、西洋占星術             │
│                                            │
│  経歴・資格                                 │
│  ────────────────────────                  │
├────────────────────────────────────────────┤
│  サービス一覧                               │
│  ┌─────────────────────────────────────┐  │
│  │ タロット鑑定 20分                     │  │
│  │ ビデオ通話 ¥3,000            [予約]   │  │
│  └─────────────────────────────────────┘  │
│  ┌─────────────────────────────────────┐  │
│  │ 総合運勢鑑定 40分                     │  │
│  │ 電話 ¥5,000                  [予約]   │  │
│  └─────────────────────────────────────┘  │
├────────────────────────────────────────────┤
│  [この占い師に予約する]                     │
└────────────────────────────────────────────┘
```

---

## 7. 料金体系

### 7.1 プラットフォーム手数料

| 項目 | 料率 |
|------|------|
| 初期費用 | 無料 |
| 月額費用 | 無料 |
| 決済手数料 | 3.6% |
| サービス手数料 | 15% |
| **合計** | **18.6%** |

※ 売上発生時のみ手数料が発生

### 7.2 振込について

| 項目 | 内容 |
|------|------|
| 振込手数料 | 300円/回 |
| 最低振込金額 | 3,000円 |
| 振込サイクル | 月2回（15日・月末締め、翌月10日・25日払い） |

### 7.3 相談者向け料金目安

| 鑑定形式 | 時間 | 料金レンジ |
|---------|------|-----------|
| チャット鑑定 | 10分 | ¥1,000〜¥3,000 |
| 電話鑑定 | 20分 | ¥2,000〜¥5,000 |
| ビデオ通話鑑定 | 30分 | ¥3,000〜¥8,000 |
| メール鑑定 | 1件 | ¥3,000〜¥10,000 |

---

## 8. セキュリティ要件

### 8.1 認証・認可

- JWT（JSON Web Token）によるステートレス認証
- リフレッシュトークンによるセッション管理
- OAuth 2.0によるソーシャルログイン
- 2要素認証（SMS/認証アプリ）オプション
- パスワードポリシー（8文字以上、英数字混合）

### 8.2 データ保護

- 通信の暗号化（TLS 1.3）
- データベース暗号化（AES-256）
- 個人情報のマスキング
- PCI DSS準拠（決済情報）
- 定期的なセキュリティ監査

### 8.3 不正利用対策

- レート制限（API呼び出し制限）
- 異常検知システム
- なりすまし防止（本人確認）
- 不正レビュー検出
- ブロック機能

---

## 9. 非機能要件

### 9.1 性能要件

| 項目 | 目標値 |
|------|--------|
| ページロード時間 | 3秒以内 |
| API応答時間 | 500ms以内（95パーセンタイル） |
| 同時接続数 | 10,000ユーザー |
| 可用性 | 99.9%（年間停止時間8.76時間以内） |

### 9.2 スケーラビリティ

- 水平スケーリング対応
- コンテナオーケストレーション（Kubernetes）
- CDNによる静的ファイル配信
- データベースのリードレプリカ

### 9.3 運用監視

- リアルタイムログモニタリング
- エラーアラート通知
- パフォーマンスメトリクス収集
- 定期バックアップ（日次）

---

## 10. 開発ロードマップ

### Phase 1: MVP（3ヶ月）
- 基本的な認証機能
- 占い師プロフィール・サービス登録
- 予約・決済機能（クレジットカードのみ）
- ビデオ通話鑑定
- 基本的なレビュー機能
- レスポンシブWebアプリ

### Phase 2: 機能拡充（2ヶ月）
- チャット鑑定
- メール鑑定
- クーポン・回数券
- 顧客管理（CRM）
- 管理者ダッシュボード強化

### Phase 3: 成長機能（2ヶ月）
- ネイティブアプリ（iOS/Android）
- サブスクリプション機能
- デジタルコンテンツ販売
- 紹介プログラム
- 多言語対応（英語）

### Phase 4: 拡張（継続）
- AIマッチング機能
- ブログ・コンテンツ機能
- オンラインサロン
- 占い師向け分析ツール強化

---

## 11. KPI・成功指標

### 11.1 事業KPI

| 指標 | 1年目目標 |
|------|----------|
| 登録占い師数 | 500名 |
| 月間アクティブユーザー | 50,000人 |
| 月間取引件数 | 10,000件 |
| 月間GMV（流通総額） | 5,000万円 |
| 顧客獲得コスト（CAC） | ¥3,000以下 |

### 11.2 プロダクトKPI

| 指標 | 目標 |
|------|------|
| ユーザー継続率（30日） | 40%以上 |
| 予約完了率 | 80%以上 |
| レビュー投稿率 | 30%以上 |
| 占い師リピート率 | 60%以上 |
| NPS（推奨度） | +30以上 |

---

## 12. 法務・コンプライアンス

### 12.1 必要な対応

- 利用規約の策定
- プライバシーポリシーの策定
- 特定商取引法に基づく表記
- 資金決済法への対応確認
- 景品表示法への対応

### 12.2 占い業界特有の考慮事項

- 「占いは娯楽目的であり、医療・法律相談の代替ではない」旨の明記
- 未成年者の利用制限
- 依存防止のための利用制限オプション
- 不適切な鑑定（霊感商法等）の禁止明記

---

## 13. 付録

### 13.1 用語集

| 用語 | 説明 |
|------|------|
| 占い師（Diviner） | サービス提供者 |
| 相談者（Client） | サービス利用者 |
| 鑑定（Consultation） | 占いセッション |
| 占術（Divination Type） | 占いの種類・手法 |

### 13.2 参考サービス

- MOSH（予約・決済プラットフォーム）
- ココナラ（スキルマーケット）
- 電話占いヴェルニ
- LINEトーク占い
- ミラー（占いマッチングアプリ）

---

**ドキュメント情報**
- バージョン: 1.0
- 作成日: 2025年12月
- 作成者: プロダクトチーム
